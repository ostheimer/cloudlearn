"use strict";exports.id=270,exports.ids=[270],exports.modules={6270:(a,b,c)=>{c.d(b,{$F:()=>J,GW:()=>e,O_:()=>B});var d=(a=>(a[a.New=0]="New",a[a.Learning=1]="Learning",a[a.Review=2]="Review",a[a.Relearning=3]="Relearning",a))(d||{}),e=(a=>(a[a.Manual=0]="Manual",a[a.Again=1]="Again",a[a.Hard=2]="Hard",a[a.Good=3]="Good",a[a.Easy=4]="Easy",a))(e||{});class f{static card(a){return{...a,state:f.state(a.state),due:f.time(a.due),last_review:a.last_review?f.time(a.last_review):void 0}}static rating(a){if("string"==typeof a){let b=a.charAt(0).toUpperCase(),c=a.slice(1).toLowerCase(),d=e[`${b}${c}`];if(void 0===d)throw Error(`Invalid rating:[${a}]`);return d}if("number"==typeof a)return a;throw Error(`Invalid rating:[${a}]`)}static state(a){if("string"==typeof a){let b=a.charAt(0).toUpperCase(),c=a.slice(1).toLowerCase(),e=d[`${b}${c}`];if(void 0===e)throw Error(`Invalid state:[${a}]`);return e}if("number"==typeof a)return a;throw Error(`Invalid state:[${a}]`)}static time(a){let b=new Date(a);if("object"==typeof a&&null!==a&&!Number.isNaN(Date.parse(a)||+b))return b;if("string"==typeof a){let b=Date.parse(a);if(!Number.isNaN(b))return new Date(b)}else if("number"==typeof a)return new Date(a);throw Error(`Invalid date:[${a}]`)}static review_log(a){return{...a,due:f.time(a.due),rating:f.rating(a.rating),state:f.state(a.state),review:f.time(a.review)}}}function g(a,b,c){return new Date(c?f.time(a).getTime()+24*b*36e5:f.time(a).getTime()+60*b*1e3)}function h(a,b,c){if(!a||!b)throw Error("Invalid date");let d=f.time(a).getTime()-f.time(b).getTime(),e=0;switch(c){case"days":e=Math.floor(d/864e5);break;case"minutes":e=Math.floor(d/6e4)}return e}function i(a){return a<10?`0${a}`:`${a}`}Date.prototype.scheduler=function(a,b){return g(this,a,b)},Date.prototype.diff=function(a,b){return h(this,a,b)},Date.prototype.format=function(){return function(a){let b=f.time(a),c=b.getFullYear(),d=b.getMonth()+1,e=b.getDate(),g=b.getHours(),h=b.getMinutes(),j=b.getSeconds();return`${c}-${i(d)}-${i(e)} ${i(g)}:${i(h)}:${i(j)}`}(this)},Date.prototype.dueFormat=function(a,b,c){return function(a,b,c,d=k){a=f.time(a),b=f.time(b),d.length!==k.length&&(d=k);let e=a.getTime()-b.getTime(),g=0;for(e/=1e3,g=0;g<j.length;g++)if(e<j[g])break;else e/=j[g];return`${Math.floor(e)}${c?d[g]:""}`}(this,a,b,c)};let j=[60,60,24,31,12],k=["second","min","hour","day","month","year"],l=Object.freeze([e.Again,e.Hard,e.Good,e.Easy]),m=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function n(a,b,c){return Math.min(Math.max(a,b),c)}let o=a=>{let b=a.slice(-1),c=parseInt(a.slice(0,-1),10);if(Number.isNaN(c)||!Number.isFinite(c)||c<0)throw Error(`Invalid step value: ${a}`);switch(b){case"m":return c;case"h":return 60*c;case"d":return 1440*c;default:throw Error(`Invalid step unit: ${a}, expected m/h/d`)}},p=(a,b,c)=>{let f=b===d.Relearning||b===d.Review?a.relearning_steps:a.learning_steps,g=f.length;if(0===g||c>=g)return{};let h=f[0],i=a=>a<0||a>=g?null:f[a],j={},k=i(Math.max(0,c));if(b===d.Review)j[e.Again]={scheduled_minutes:o(k),next_step:0};else{j[e.Again]={scheduled_minutes:o(h),next_step:0},j[e.Hard]={scheduled_minutes:(()=>{if(1===g)return Math.round(1.5*o(h));let a=f[1];return Math.round((o(h)+o(a))/2)})(),next_step:c};let a=i(c+1);if(a){let b=o(a);b&&(j[e.Good]={scheduled_minutes:Math.round(b),next_step:c+1})}}return j};function q(){let a=this.review_time.getTime(),b=this.current.reps,c=this.current.difficulty*this.current.stability;return`${a}_${b}_${c}`}var r=(a=>(a.SCHEDULER="Scheduler",a.LEARNING_STEPS="LearningSteps",a.SEED="Seed",a))(r||{});class s{last;current;review_time;next=new Map;algorithm;strategies;elapsed_days=0;constructor(a,b,c,d){this.algorithm=c,this.last=f.card(a),this.current=f.card(a),this.review_time=f.time(b),this.strategies=d,this.init()}checkGrade(a){if(!Number.isFinite(a)||a<0||a>4)throw Error(`Invalid grade "${a}",expected 1-4`)}init(){let{state:a,last_review:b}=this.current,c=0;a!==d.New&&b&&(c=function(a,b){let c=Date.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate());return Math.floor((Date.UTC(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())-c)/864e5)}(b,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=c,this.current.elapsed_days=c,this.current.reps+=1;let e=q;if(this.strategies){let a=this.strategies.get(r.SEED);a&&(e=a)}this.algorithm.seed=e.call(this)}preview(){return{[e.Again]:this.review(e.Again),[e.Hard]:this.review(e.Hard),[e.Good]:this.review(e.Good),[e.Easy]:this.review(e.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let a of l)yield this.review(a)}review(a){let b,{state:c}=this.last;switch(this.checkGrade(a),c){case d.New:b=this.newState(a);break;case d.Learning:case d.Relearning:b=this.learningState(a);break;case d.Review:b=this.reviewState(a)}return b}buildLog(a){let{last_review:b,due:c,elapsed_days:d}=this.last;return{rating:a,state:this.current.state,due:b||c,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:d,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}}class t{c;s0;s1;s2;constructor(a){let b=function(){let a=0xefc8249d;return function(b){b=String(b);for(let c=0;c<b.length;c++){let d=.02519603282416938*(a+=b.charCodeAt(c));a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=0x100000000*d}return(a>>>0)*23283064365386963e-26}}();this.c=1,this.s0=b(" "),this.s1=b(" "),this.s2=b(" "),null==a&&(a=Date.now()),this.s0-=b(a),this.s0<0&&(this.s0+=1),this.s1-=b(a),this.s1<0&&(this.s1+=1),this.s2-=b(a),this.s2<0&&(this.s2+=1)}next(){let a=2091639*this.s0+23283064365386963e-26*this.c;return this.s0=this.s1,this.s1=this.s2,this.c=0|a,this.s2=a-this.c,this.s2}set state(a){this.c=a.c,this.s0=a.s0,this.s1=a.s1,this.s2=a.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}}let u=!0,v=Object.freeze(["1m","10m"]),w=Object.freeze(["10m"]),x=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,.1542]),y=(a,b,c=u)=>{let d=2;return Math.max(0,b)>1&&(d=n(+(-(Math.log(a[11])+Math.log(Math.pow(2,a[13])-1)+.3*a[14])/b).toFixed(8),.01,2)),((a,b=u)=>[[.001,100],[.001,100],[.001,100],[.001,100],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,a],[0,a],[.01*!!b,.8],[.1,.8]])(d,c).slice(0,a.length).map(([b,c],d)=>n(a[d]||0,b,c))},z=(a,b=0,c=u)=>{if(void 0===a)return[...x];switch(a.length){case 21:return y(Array.from(a),b,c);case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),y(Array.from(a),b,c).concat([0,.5]);case 17:{let d=y(Array.from(a),b,c);return d[4]=+(2*d[5]+d[4]).toFixed(8),d[5]=+(Math.log(3*d[5]+1)/3).toFixed(8),d[6]=+(d[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),d.concat([0,0,0,.5])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...x]}},A=a=>{let b=Array.isArray(a?.learning_steps)?a.learning_steps:v,c=Array.isArray(a?.relearning_steps)?a.relearning_steps:w,d=a?.enable_short_term??u,e=z(a?.w,c.length,d);return{request_retention:a?.request_retention||.9,maximum_interval:a?.maximum_interval||36500,w:e,enable_fuzz:a?.enable_fuzz??!1,enable_short_term:d,learning_steps:b,relearning_steps:c}};function B(a,b){let c={due:a?f.time(a):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:d.New,last_review:void 0};return b&&"function"==typeof b?b(c):c}let C=a=>{let b="number"==typeof a?-a:-a[20],c=Math.exp(Math.pow(b,-1)*Math.log(.9))-1;return{decay:b,factor:+c.toFixed(8)}};function D(a,b,c){let{decay:d,factor:e}=C(a);return+Math.pow(1+e*b/c,d).toFixed(8)}class E{param;intervalModifier;_seed;constructor(a){this.param=new Proxy(A(a),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=D.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(a){this._seed=a}calculate_interval_modifier(a){if(a<=0||a>1)throw Error("Requested retention rate should be in the range (0,1]");let{decay:b,factor:c}=C(this.param.w);return+((Math.pow(a,1/b)-1)/c).toFixed(8)}get parameters(){return this.param}set parameters(a){this.update_parameters(a)}params_handler_proxy(){let a=this;return{set:function(b,c,d){return"request_retention"===c&&Number.isFinite(d)?a.intervalModifier=a.calculate_interval_modifier(Number(d)):"w"===c&&(d=z(d,b.relearning_steps.length,b.enable_short_term),a.forgetting_curve=D.bind(this,d),a.intervalModifier=a.calculate_interval_modifier(Number(b.request_retention))),Reflect.set(b,c,d),!0}}}update_parameters(a){let b=A(a);for(let a in b)this.param[a]=b[a]}init_stability(a){return Math.max(this.param.w[a-1],.1)}init_difficulty(a){return+(this.param.w[4]-Math.exp((a-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(a,b){if(!this.param.enable_fuzz||a<2.5)return Math.round(a);let c=(function(a){let b=new t(a),c=()=>b.next();return c.int32=()=>0x100000000*b.next()|0,c.double=()=>c()+(2097152*c()|0)*11102230246251565e-32,c.state=()=>b.state,c.importState=a=>(b.state=a,c),c})(this._seed)(),{min_ivl:d,max_ivl:e}=function(a,b,c){let d=1;for(let b of m)d+=b.factor*Math.max(Math.min(a,b.end)-b.start,0);let e=Math.max(2,Math.round((a=Math.min(a,c))-d)),f=Math.min(Math.round(a+d),c);return a>b&&(e=Math.max(e,b+1)),{min_ivl:e=Math.min(e,f),max_ivl:f}}(a,b,this.param.maximum_interval);return Math.floor(c*(e-d+1)+d)}next_interval(a,b){let c=Math.min(Math.max(1,Math.round(a*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(c,b)}linear_damping(a,b){return+(a*(10-b)/9).toFixed(8)}next_difficulty(a,b){let c=-this.param.w[6]*(b-3),d=a+this.linear_damping(c,a);return n(this.mean_reversion(this.init_difficulty(e.Easy),d),1,10)}mean_reversion(a,b){return+(this.param.w[7]*a+(1-this.param.w[7])*b).toFixed(8)}next_recall_stability(a,b,c,d){let f=e.Hard===d?this.param.w[15]:1,g=e.Easy===d?this.param.w[16]:1;return+n(b*(1+Math.exp(this.param.w[8])*(11-a)*Math.pow(b,-this.param.w[9])*(Math.exp((1-c)*this.param.w[10])-1)*f*g),.001,36500).toFixed(8)}next_forget_stability(a,b,c){return+n(this.param.w[11]*Math.pow(a,-this.param.w[12])*(Math.pow(b+1,this.param.w[13])-1)*Math.exp((1-c)*this.param.w[14]),.001,36500).toFixed(8)}next_short_term_stability(a,b){let c=Math.pow(a,-this.param.w[19])*Math.exp(this.param.w[17]*(b-3+this.param.w[18]));return+n(a*(b>=3?Math.max(c,1):c),.001,36500).toFixed(8)}forgetting_curve;next_state(a,b,c){let{difficulty:d,stability:e}=a??{difficulty:0,stability:0};if(b<0)throw Error(`Invalid delta_t "${b}"`);if(c<0||c>4)throw Error(`Invalid grade "${c}"`);if(0===d&&0===e)return{difficulty:n(this.init_difficulty(c),1,10),stability:this.init_stability(c)};if(0===c)return{difficulty:d,stability:e};if(d<1||e<.001)throw Error(`Invalid memory state { difficulty: ${d}, stability: ${e} }`);let f=this.forgetting_curve(b,e),g=this.next_recall_stability(d,e,f,c),h=this.next_forget_stability(d,e,f),i=this.next_short_term_stability(e,c),j=g;if(1===c){let[a,b]=[0,0];this.param.enable_short_term&&(a=this.param.w[17],b=this.param.w[18]),j=n(+(e/Math.exp(a*b)).toFixed(8),.001,h)}return 0===b&&this.param.enable_short_term&&(j=i),{difficulty:this.next_difficulty(d,c),stability:j}}}class F extends s{learningStepsStrategy;constructor(a,b,c,d){super(a,b,c,d);let e=p;if(this.strategies){let a=this.strategies.get(r.LEARNING_STEPS);a&&(e=a)}this.learningStepsStrategy=e}getLearningInfo(a,b){let c=this.algorithm.parameters;a.learning_steps=a.learning_steps||0;let f=this.learningStepsStrategy(c,a.state,this.current.state===d.Learning&&b!==e.Again&&b!==e.Hard?a.learning_steps+1:a.learning_steps);return{scheduled_minutes:Math.max(0,f[b]?.scheduled_minutes??0),next_steps:Math.max(0,f[b]?.next_step??0)}}applyLearningSteps(a,b,c){let{scheduled_minutes:e,next_steps:f}=this.getLearningInfo(this.current,b);if(e>0&&e<1440)a.learning_steps=f,a.scheduled_days=0,a.state=c,a.due=g(this.review_time,Math.round(e),!1);else if(a.state=d.Review,e>=1440)a.learning_steps=f,a.due=g(this.review_time,Math.round(e),!1),a.scheduled_days=Math.floor(e/1440);else{a.learning_steps=0;let b=this.algorithm.next_interval(a.stability,this.elapsed_days);a.scheduled_days=b,a.due=g(this.review_time,b,!0)}}newState(a){let b=this.next.get(a);if(b)return b;let c=f.card(this.current);c.difficulty=n(this.algorithm.init_difficulty(a),1,10),c.stability=this.algorithm.init_stability(a),this.applyLearningSteps(c,a,d.Learning);let e={card:c,log:this.buildLog(a)};return this.next.set(a,e),e}learningState(a){let b=this.next.get(a);if(b)return b;let{state:c,difficulty:d,stability:e}=this.last,g=f.card(this.current);g.difficulty=this.algorithm.next_difficulty(d,a),g.stability=this.algorithm.next_short_term_stability(e,a),this.applyLearningSteps(g,a,c);let h={card:g,log:this.buildLog(a)};return this.next.set(a,h),h}reviewState(a){let b=this.next.get(a);if(b)return b;let c=this.elapsed_days,{difficulty:g,stability:h}=this.last,i=this.algorithm.forgetting_curve(c,h),j=f.card(this.current),k=f.card(this.current),l=f.card(this.current),m=f.card(this.current);this.next_ds(j,k,l,m,g,h,i),this.next_interval(k,l,m,c),this.next_state(k,l,m),this.applyLearningSteps(j,e.Again,d.Relearning),j.lapses+=1;let n={card:j,log:this.buildLog(e.Again)},o={card:k,log:super.buildLog(e.Hard)},p={card:l,log:super.buildLog(e.Good)},q={card:m,log:super.buildLog(e.Easy)};return this.next.set(e.Again,n),this.next.set(e.Hard,o),this.next.set(e.Good,p),this.next.set(e.Easy,q),this.next.get(a)}next_ds(a,b,c,d,f,g,h){a.difficulty=this.algorithm.next_difficulty(f,e.Again);let i=g/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),j=this.algorithm.next_forget_stability(f,g,h);a.stability=n(+i.toFixed(8),.001,j),b.difficulty=this.algorithm.next_difficulty(f,e.Hard),b.stability=this.algorithm.next_recall_stability(f,g,h,e.Hard),c.difficulty=this.algorithm.next_difficulty(f,e.Good),c.stability=this.algorithm.next_recall_stability(f,g,h,e.Good),d.difficulty=this.algorithm.next_difficulty(f,e.Easy),d.stability=this.algorithm.next_recall_stability(f,g,h,e.Easy)}next_interval(a,b,c,d){let e,f;e=Math.min(e=this.algorithm.next_interval(a.stability,d),f=this.algorithm.next_interval(b.stability,d)),f=Math.max(f,e+1);let h=Math.max(this.algorithm.next_interval(c.stability,d),f+1);a.scheduled_days=e,a.due=g(this.review_time,e,!0),b.scheduled_days=f,b.due=g(this.review_time,f,!0),c.scheduled_days=h,c.due=g(this.review_time,h,!0)}next_state(a,b,c){a.state=d.Review,a.learning_steps=0,b.state=d.Review,b.learning_steps=0,c.state=d.Review,c.learning_steps=0}}class G extends s{newState(a){let b=this.next.get(a);if(b)return b;this.current.scheduled_days=0,this.current.elapsed_days=0;let c=f.card(this.current),d=f.card(this.current),e=f.card(this.current),g=f.card(this.current);return this.init_ds(c,d,e,g),this.next_interval(c,d,e,g,0),this.next_state(c,d,e,g),this.update_next(c,d,e,g),this.next.get(a)}init_ds(a,b,c,d){a.difficulty=n(this.algorithm.init_difficulty(e.Again),1,10),a.stability=this.algorithm.init_stability(e.Again),b.difficulty=n(this.algorithm.init_difficulty(e.Hard),1,10),b.stability=this.algorithm.init_stability(e.Hard),c.difficulty=n(this.algorithm.init_difficulty(e.Good),1,10),c.stability=this.algorithm.init_stability(e.Good),d.difficulty=n(this.algorithm.init_difficulty(e.Easy),1,10),d.stability=this.algorithm.init_stability(e.Easy)}learningState(a){return this.reviewState(a)}reviewState(a){let b=this.next.get(a);if(b)return b;let c=this.elapsed_days,{difficulty:d,stability:e}=this.last,g=this.algorithm.forgetting_curve(c,e),h=f.card(this.current),i=f.card(this.current),j=f.card(this.current),k=f.card(this.current);return this.next_ds(h,i,j,k,d,e,g),this.next_interval(h,i,j,k,c),this.next_state(h,i,j,k),h.lapses+=1,this.update_next(h,i,j,k),this.next.get(a)}next_ds(a,b,c,d,f,g,h){a.difficulty=this.algorithm.next_difficulty(f,e.Again);let i=this.algorithm.next_forget_stability(f,g,h);a.stability=n(g,.001,i),b.difficulty=this.algorithm.next_difficulty(f,e.Hard),b.stability=this.algorithm.next_recall_stability(f,g,h,e.Hard),c.difficulty=this.algorithm.next_difficulty(f,e.Good),c.stability=this.algorithm.next_recall_stability(f,g,h,e.Good),d.difficulty=this.algorithm.next_difficulty(f,e.Easy),d.stability=this.algorithm.next_recall_stability(f,g,h,e.Easy)}next_interval(a,b,c,d,e){let f,h,i,j;f=this.algorithm.next_interval(a.stability,e),h=this.algorithm.next_interval(b.stability,e),i=this.algorithm.next_interval(c.stability,e),j=this.algorithm.next_interval(d.stability,e),f=Math.min(f,h),j=Math.max(j,(i=Math.max(i,(h=Math.max(h,f+1))+1))+1),a.scheduled_days=f,a.due=g(this.review_time,f,!0),b.scheduled_days=h,b.due=g(this.review_time,h,!0),c.scheduled_days=i,c.due=g(this.review_time,i,!0),d.scheduled_days=j,d.due=g(this.review_time,j,!0)}next_state(a,b,c,e){a.state=d.Review,a.learning_steps=0,b.state=d.Review,b.learning_steps=0,c.state=d.Review,c.learning_steps=0,e.state=d.Review,e.learning_steps=0}update_next(a,b,c,d){let f={card:a,log:this.buildLog(e.Again)},g={card:b,log:super.buildLog(e.Hard)},h={card:c,log:super.buildLog(e.Good)},i={card:d,log:super.buildLog(e.Easy)};this.next.set(e.Again,f),this.next.set(e.Hard,g),this.next.set(e.Good,h),this.next.set(e.Easy,i)}}class H{fsrs;constructor(a){this.fsrs=a}replay(a,b,c){return this.fsrs.next(a,b,c)}handleManualRating(a,b,c,f,g,i,j){let k,l;if(void 0===b)throw Error("reschedule: state is required for manual rating");if(b===d.New)k={rating:e.Manual,state:b,due:j??c,stability:a.stability,difficulty:a.difficulty,elapsed_days:f,last_elapsed_days:a.elapsed_days,scheduled_days:a.scheduled_days,learning_steps:a.learning_steps,review:c},(l=B(c)).last_review=c;else{if(void 0===j)throw Error("reschedule: due is required for manual rating");let d=h(j,c,"days");k={rating:e.Manual,state:a.state,due:a.last_review||a.due,stability:a.stability,difficulty:a.difficulty,elapsed_days:f,last_elapsed_days:a.elapsed_days,scheduled_days:a.scheduled_days,learning_steps:a.learning_steps,review:c},l={...a,state:b,due:j,last_review:c,stability:g||a.stability,difficulty:i||a.difficulty,elapsed_days:f,scheduled_days:d,reps:a.reps+1}}return{card:l,log:k}}reschedule(a,b){let c=[],g=B(a.due);for(let a of b){let b;if(a.review=f.time(a.review),a.rating===e.Manual){let c=0;g.state!==d.New&&g.last_review&&(c=h(a.review,g.last_review,"days")),b=this.handleManualRating(g,a.state,a.review,c,a.stability,a.difficulty,a.due?f.time(a.due):void 0)}else b=this.replay(g,a.review,a.rating);c.push(b),g=b.card}return c}calculateManualRecord(a,b,c,d){if(!c)return null;let{card:e,log:g}=c,i=f.card(a);return i.due.getTime()===e.due.getTime()?null:(i.scheduled_days=h(e.due,i.due,"days"),this.handleManualRating(i,e.state,f.time(b),g.elapsed_days,d?e.stability:void 0,d?e.difficulty:void 0,e.due))}}class I extends E{strategyHandler=new Map;Scheduler;constructor(a){super(a);let{enable_short_term:b}=this.parameters;this.Scheduler=b?F:G}params_handler_proxy(){let a=this;return{set:function(b,c,d){return"request_retention"===c&&Number.isFinite(d)?a.intervalModifier=a.calculate_interval_modifier(Number(d)):"enable_short_term"===c?a.Scheduler=!0===d?F:G:"w"===c&&(d=z(d,b.relearning_steps.length,b.enable_short_term),a.forgetting_curve=D.bind(this,d),a.intervalModifier=a.calculate_interval_modifier(Number(b.request_retention))),Reflect.set(b,c,d),!0}}}useStrategy(a,b){return this.strategyHandler.set(a,b),this}clearStrategy(a){return a?this.strategyHandler.delete(a):this.strategyHandler.clear(),this}getScheduler(a,b){return new(this.strategyHandler.get(r.SCHEDULER)||this.Scheduler)(a,b,this,this.strategyHandler)}repeat(a,b,c){let d=this.getScheduler(a,b).preview();return c&&"function"==typeof c?c(d):d}next(a,b,c,d){let g=this.getScheduler(a,b),h=f.rating(c);if(h===e.Manual)throw Error("Cannot review a manual rating");let i=g.review(h);return d&&"function"==typeof d?d(i):i}get_retrievability(a,b,c=!0){let e=f.card(a);b=b?f.time(b):new Date;let g=e.state!==d.New?Math.max(h(b,e.last_review,"days"),0):0,i=e.state!==d.New?this.forgetting_curve(g,+e.stability.toFixed(8)):0;return c?`${(100*i).toFixed(2)}%`:i}rollback(a,b,c){let g,h,i,j=f.card(a),k=f.review_log(b);if(k.rating===e.Manual)throw Error("Cannot rollback a manual rating");switch(k.state){case d.New:g=k.due,h=void 0,i=0;break;case d.Learning:case d.Relearning:case d.Review:g=k.review,h=k.due,i=j.lapses-(k.rating===e.Again&&k.state===d.Review)}let l={...j,due:g,stability:k.stability,difficulty:k.difficulty,elapsed_days:k.last_elapsed_days,scheduled_days:k.scheduled_days,reps:Math.max(0,j.reps-1),lapses:Math.max(0,i),learning_steps:k.learning_steps,state:k.state,last_review:h};return c&&"function"==typeof c?c(l):l}forget(a,b,c=!1,g){let i=f.card(a);b=f.time(b);let j=i.state===d.New?0:h(b,i.due,"days"),k={rating:e.Manual,state:i.state,due:i.due,stability:i.stability,difficulty:i.difficulty,elapsed_days:0,last_elapsed_days:i.elapsed_days,scheduled_days:j,learning_steps:i.learning_steps,review:b},l={card:{...i,due:b,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:c?0:i.reps,lapses:c?0:i.lapses,learning_steps:0,state:d.New,last_review:i.last_review},log:k};return g&&"function"==typeof g?g(l):l}reschedule(a,b=[],c={}){let{recordLogHandler:d,reviewsOrderBy:g,skipManual:h=!0,now:i=new Date,update_memory_state:j=!1}=c;g&&"function"==typeof g&&b.sort(g),h&&(b=b.filter(a=>a.rating!==e.Manual));let k=new H(this),l=k.reschedule(c.first_card||B(),b),m=l.length,n=f.card(a),o=k.calculateManualRecord(n,i,m?l[m-1]:void 0,j);return d&&"function"==typeof d?{collections:l.map(d),reschedule_item:o?d(o):null}:{collections:l,reschedule_item:o}}}let J=a=>new I(a||{})}};