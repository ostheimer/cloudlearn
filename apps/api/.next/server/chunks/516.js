exports.id=516,exports.ids=[516],exports.modules={1364:(a,b,c)=>{"use strict";c.d(b,{v:()=>f});var d=c(2356),e=c(4735);function f(){let a=(0,e._)();return a.NEXT_PUBLIC_SUPABASE_URL&&a.SUPABASE_SERVICE_ROLE_KEY?(0,d.UU)(a.NEXT_PUBLIC_SUPABASE_URL,a.SUPABASE_SERVICE_ROLE_KEY):null}},2028:(a,b,c)=>{"use strict";c.d(b,{Fy:()=>i,IG:()=>j,a2:()=>k});var d=c(2115),e=c(403),f=c(9544);let g=e.Ikc({userId:e.YjP().uuid(),deckId:e.YjP().uuid(),card:d.cd}),h=e.Ikc({cardId:e.YjP().uuid(),front:e.YjP().min(1).optional(),back:e.YjP().min(1).optional(),type:d.cd.shape.type.optional(),difficulty:d.cd.shape.difficulty.optional(),tags:d.cd.shape.tags.optional()});async function i(a){let b=g.parse(a);return(0,f.zY)(b.userId,b.deckId,b.card)}async function j(a){let b=h.parse(a),c={};return void 0!==b.front&&(c.front=b.front),void 0!==b.back&&(c.back=b.back),void 0!==b.type&&(c.type=b.type),void 0!==b.difficulty&&(c.difficulty=b.difficulty),void 0!==b.tags&&(c.tags=b.tags),(0,f.w0)(b.cardId,c)}async function k(a){return(0,f.WO)(a)}},2115:(a,b,c)=>{"use strict";c.d(b,{AT:()=>o,Hr:()=>i,IN:()=>h,LP:()=>q,N2:()=>r,QT:()=>t,Xo:()=>s,cd:()=>g,tW:()=>k});var d=c(403);let e=d.k5n(["basic","cloze","mcq","matching"]),f=d.k5n(["easy","medium","hard"]),g=d.Ikc({front:d.YjP().min(1).max(500),back:d.YjP().min(1).max(1e3),type:e.default("basic"),difficulty:f.default("medium"),tags:d.YOg(d.YjP().min(1).max(40)).max(10).default([])}),h=d.YOg(g).min(1).max(50),i=d.Ikc({userId:d.YjP().uuid(),extractedText:d.YjP().min(1).max(2e4).optional(),imageBase64:d.YjP().min(100).max(1e7).optional(),imageMimeType:d.k5n(["image/jpeg","image/png","image/webp"]).optional(),idempotencyKey:d.YjP().min(8).max(128),sourceLanguage:d.YjP().min(2).max(10).default("de"),sourceImageUrl:d.YjP().url().optional(),deckId:d.YjP().uuid().optional()}).refine(a=>!!a.extractedText||!!a.imageBase64,{message:"Either extractedText or imageBase64 must be provided"});d.Ikc({requestId:d.YjP().min(8),model:d.YjP().min(2),fallbackUsed:d.zMY().default(!1),cards:h});let j=d.k5n(["again","hard","good","easy"]),k=d.Ikc({userId:d.YjP().uuid(),cardId:d.YjP().uuid(),rating:j,reviewedAt:d.YjP().datetime(),reviewDurationMs:d.aig().int().nonnegative().max(12e4).optional(),idempotencyKey:d.YjP().min(8).max(128)}),l=d.k5n(["new","learning","review","relearning"]);d.Ikc({requestId:d.YjP().min(8),cardId:d.YjP().uuid(),nextDueAt:d.YjP().datetime(),stability:d.aig().nonnegative(),difficulty:d.aig().nonnegative(),state:l});let m=d.k5n(["review","card_update","deck_update","delete"]),n=d.Ikc({operationId:d.YjP().min(8).max(128),operationType:m,createdAt:d.YjP().datetime(),payload:d.KCZ([k,d.Ikc({cardId:d.YjP().uuid(),front:d.YjP().min(1),back:d.YjP().min(1)}),d.Ikc({deckId:d.YjP().uuid(),title:d.YjP().min(1)}),d.Ikc({entity:d.k5n(["card","deck"]),entityId:d.YjP().uuid()})])}),o=d.Ikc({userId:d.YjP().uuid(),operations:d.YOg(n).max(500)});d.Ikc({requestId:d.YjP().min(8),acceptedOperationIds:d.YOg(d.YjP()),rejectedOperationIds:d.YOg(d.YjP()),serverTimestamp:d.YjP().datetime()});let p=d.k5n(["free","pro","lifetime"]),q=d.Ikc({userId:d.YjP().uuid(),tier:p,isActive:d.zMY(),expiresAt:d.YjP().datetime().nullable()}),r=d.Ikc({event:d.Ikc({app_user_id:d.YjP(),type:d.YjP(),entitlement_ids:d.YOg(d.YjP()).optional(),expiration_at_ms:d.aig().int().nullable().optional()})}),s=d.Ikc({userId:d.YjP().uuid(),channel:d.k5n(["in_app","email","interview"]).default("in_app"),rating:d.aig().int().min(1).max(5),message:d.YjP().min(3).max(5e3),category:d.k5n(["bug","ux","feature","performance","other"]).default("other")}),t=d.Ikc({jobId:d.YjP().min(8),userId:d.YjP().uuid(),fileName:d.YjP().min(1),pageCount:d.aig().int().positive(),status:d.k5n(["queued","processing","completed","failed"]),retries:d.aig().int().nonnegative().default(0)})},2671:()=>{},3341:(a,b,c)=>{"use strict";c.d(b,{LF:()=>e,TQ:()=>h,fH:()=>f,vV:()=>g});var d=c(7598);function e(a){return{requestId:a.get("x-request-id")??(0,d.randomUUID)()}}function f(a,b){console.info(JSON.stringify({level:"info",message:a,...b}))}function g(a,b){console.error(JSON.stringify({level:"error",message:a,...b}))}function h(a){let b=new Headers;return b.set("x-request-id",a),b}},3402:(a,b,c)=>{"use strict";c.d(b,{FZ:()=>h,cQ:()=>i,h4:()=>g});var d=c(4073),e=c(403),f=c(3341);function g(a,b,c=200){return d.NextResponse.json(b,{status:c,headers:(0,f.TQ)(a)})}function h(a,b,c,e=400){return d.NextResponse.json({code:b,message:c,request_id:a},{status:e,headers:(0,f.TQ)(a)})}function i(a){return a instanceof e.GaX?{code:"VALIDATION_ERROR",message:a.message,status:422}:a instanceof Error?"Card not found"===a.message?{code:"CARD_NOT_FOUND",message:a.message,status:404}:{code:"INTERNAL_ERROR",message:a.message,status:500}:{code:"INTERNAL_ERROR",message:"Unknown error",status:500}}},4735:(a,b,c)=>{"use strict";c.d(b,{_:()=>g});var d=c(403);let e=d.Ikc({NEXT_PUBLIC_SUPABASE_URL:d.YjP().url().optional(),SUPABASE_ANON_KEY:d.YjP().optional(),SUPABASE_SERVICE_ROLE_KEY:d.YjP().optional(),GEMINI_API_KEY:d.YjP().optional(),OPENAI_API_KEY:d.YjP().optional(),R2_ACCOUNT_ID:d.YjP().optional(),R2_ACCESS_KEY_ID:d.YjP().optional(),R2_SECRET_ACCESS_KEY:d.YjP().optional(),R2_BUCKET_NAME:d.YjP().default("clearn-images"),R2_ENDPOINT:d.YjP().url().optional(),R2_SIGNED_URL_TTL_SECONDS:d.auy.number().int().positive().default(300),REVENUECAT_WEBHOOK_SECRET:d.YjP().optional(),FREE_SCAN_LIMIT_PER_MONTH:d.auy.number().int().positive().default(10),RATE_LIMIT_FREE_PER_MINUTE:d.auy.number().int().positive().default(60),RATE_LIMIT_PRO_PER_MINUTE:d.auy.number().int().positive().default(240)}),f=null;function g(){return f||(f=e.parse(process.env)),f}},5832:(a,b,c)=>{"use strict";c.d(b,{WV:()=>e});var d=c(1364);async function e(a){let b=a.headers.get("Authorization");if(!b?.startsWith("Bearer "))return null;let c=b.slice(7),e=(0,d.v)();if(!e)return null;let{data:{user:f},error:g}=await e.auth.getUser(c);if(g||!f)return null;let{error:h}=await e.from("profiles").insert({id:f.id});return h&&"23505"!==h.code&&console.error("[auth] profile upsert error:",h.message),{userId:f.id,email:f.email??""}}},9544:(a,b,c)=>{"use strict";c.d(b,{AI:()=>y,AV:()=>A,He:()=>o,Hs:()=>w,Ul:()=>k,WO:()=>r,XJ:()=>t,Xj:()=>n,bx:()=>v,c9:()=>x,k2:()=>m,qP:()=>u,sg:()=>s,tk:()=>l,vT:()=>z,w0:()=>q,zY:()=>p,zf:()=>B});var d=c(1364);function e(){let a=(0,d.v)();if(!a)throw Error("Supabase not configured. Set NEXT_PUBLIC_SUPABASE_URL and SUPABASE_SERVICE_ROLE_KEY.");return a}function f(a){return{id:a.id,userId:a.user_id,title:a.title,tags:a.tags??[],deletedAt:a.deleted_at??null,createdAt:a.created_at,updatedAt:a.updated_at}}function g(a){return{id:a.id,userId:a.user_id,deckId:a.deck_id,front:a.front,back:a.back,type:a.card_type??"basic",difficulty:a.difficulty??"medium",tags:a.tags??[],fsrsDue:a.fsrs_due,fsrsStability:a.fsrs_stability??0,fsrsDifficulty:a.fsrs_difficulty??0,fsrsState:a.fsrs_state??"new",deletedAt:a.deleted_at??null}}let h={again:1,hard:2,good:3,easy:4},i={1:"again",2:"hard",3:"good",4:"easy"};function j(a){return{id:a.id,userId:a.user_id,cardId:a.card_id,rating:i[a.rating]??"good",reviewedAt:a.reviewed_at,reviewDurationMs:a.review_duration_ms??void 0,idempotencyKey:a.idempotency_key}}async function k(a,b,c=[]){let d=e(),{data:g,error:h}=await d.from("decks").insert({user_id:a,title:b,tags:c}).select().single();if(h)throw Error(`createDeck: ${h.message}`);return f(g)}async function l(a){let b=e(),{data:c,error:d}=await b.from("decks").select().eq("user_id",a).is("deleted_at",null).order("created_at",{ascending:!1});if(d)throw Error(`listDecks: ${d.message}`);return(c??[]).map(f)}async function m(a){let b=e(),{data:c,error:d}=await b.from("decks").select().eq("id",a).is("deleted_at",null).maybeSingle();return d||!c?null:f(c)}async function n(a,b){let c=e(),d={updated_at:new Date().toISOString()};void 0!==b.title&&(d.title=b.title),void 0!==b.tags&&(d.tags=b.tags);let{data:g,error:h}=await c.from("decks").update(d).eq("id",a).is("deleted_at",null).select().single();return h?null:f(g)}async function o(a){let b=e(),c=new Date().toISOString(),{data:d,error:f}=await b.from("decks").update({deleted_at:c,updated_at:c}).eq("id",a).is("deleted_at",null).select("id").maybeSingle();return!f&&!!d}async function p(a,b,c){let d=e(),{data:f,error:h}=await d.from("cards").insert({user_id:a,deck_id:b,front:c.front,back:c.back,card_type:c.type,difficulty:c.difficulty,tags:c.tags??[],fsrs_due:new Date().toISOString(),fsrs_stability:0,fsrs_difficulty:0,fsrs_state:"new"}).select().single();if(h)throw Error(`createCard: ${h.message}`);return g(f)}async function q(a,b){let c=e(),d={updated_at:new Date().toISOString()};void 0!==b.front&&(d.front=b.front),void 0!==b.back&&(d.back=b.back),void 0!==b.type&&(d.card_type=b.type),void 0!==b.difficulty&&(d.difficulty=b.difficulty),void 0!==b.tags&&(d.tags=b.tags);let{data:f,error:h}=await c.from("cards").update(d).eq("id",a).is("deleted_at",null).select().single();return h?null:g(f)}async function r(a){let b=e(),{data:c,error:d}=await b.from("cards").update({deleted_at:new Date().toISOString()}).eq("id",a).is("deleted_at",null).select("id").maybeSingle();return!d&&!!c}async function s(a,b){let c=e(),{data:d,error:f}=await c.from("cards").select().eq("user_id",a).eq("deck_id",b).is("deleted_at",null).order("created_at",{ascending:!0});if(f)throw Error(`listCardsForDeck: ${f.message}`);return(d??[]).map(g)}async function t(a){let b=e(),{data:c,error:d}=await b.from("cards").select().eq("id",a).is("deleted_at",null).maybeSingle();return d||!c?null:g(c)}async function u(a,b){let c=e(),{data:d,error:f}=await c.from("cards").update({fsrs_due:b.fsrsDue,fsrs_stability:b.fsrsStability,fsrs_difficulty:b.fsrsDifficulty,fsrs_state:b.fsrsState,updated_at:new Date().toISOString()}).eq("id",a).is("deleted_at",null).select().single();return f?null:g(d)}async function v(a){let b=e(),{data:c,error:d}=await b.from("review_logs").insert({user_id:a.userId,card_id:a.cardId,rating:h[a.rating]??3,reviewed_at:a.reviewedAt,review_duration_ms:a.reviewDurationMs??null,idempotency_key:a.idempotencyKey}).select().single();if(d)throw Error(`createReview: ${d.message}`);return j(c)}async function w(a,b){let c=e(),{data:d,error:f}=await c.from("review_logs").select().eq("user_id",a).eq("idempotency_key",b).maybeSingle();return f||!d?null:j(d)}async function x(a,b){let c=e(),{data:d,error:f}=await c.from("cards").select().eq("user_id",a).is("deleted_at",null).lte("fsrs_due",b).order("fsrs_due",{ascending:!0});if(f)throw Error(`listDueCards: ${f.message}`);return(d??[]).map(g)}async function y(a){let b=e(),{data:c,error:d}=await b.from("profiles").select("subscription_tier, subscription_expires_at").eq("id",a).maybeSingle();if(d||!c)return{tier:"free",expiresAt:null,isActive:!0};let f=c.subscription_expires_at??null,g=!f||new Date(f)>new Date;return{tier:c.subscription_tier??"free",expiresAt:f,isActive:g}}async function z(a,b,c,d){let f=e();await f.from("profiles").update({subscription_tier:b,subscription_expires_at:d,updated_at:new Date().toISOString()}).eq("id",a)}async function A(a,b=50){let c=e(),{data:d,error:f}=await c.from("scans").select("id, image_url, ai_model, cards_generated, created_at").eq("user_id",a).order("created_at",{ascending:!1}).limit(b);if(f)throw Error(`listScanHistory: ${f.message}`);return(d??[]).map(a=>({id:a.id,imageUrl:a.image_url,aiModel:a.ai_model,cardsGenerated:a.cards_generated,createdAt:a.created_at}))}async function B(a,b,c,d="",f){let g=e(),{data:h,error:i}=await g.from("scans").insert({user_id:a,image_url:d,ai_model:b,cards_generated:c,extracted_text:f??null,status:"processed"}).select("id").single();if(i)throw Error(`recordScan: ${i.message}`);return h.id}},9623:()=>{}};