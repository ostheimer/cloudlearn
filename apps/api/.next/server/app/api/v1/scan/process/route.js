"use strict";(()=>{var a={};a.id=193,a.ids=[193],a.modules={261:a=>{a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:a=>{a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4131:(a,b,c)=>{c.r(b),c.d(b,{handler:()=>R,patchFetch:()=>Q,routeModule:()=>M,serverHooks:()=>P,workAsyncStorage:()=>N,workUnitAsyncStorage:()=>O});var d={};c.r(d),c.d(d,{POST:()=>L});var e=c(3808),f=c(6069),g=c(532),h=c(5222),i=c(6476),j=c(261),k=c(762),l=c(2952),m=c(4088),n=c(5915),o=c(6773),p=c(8439),q=c(2089),r=c(8414),s=c(6439),t=c(5636),u=c(4735),v=c(3402),w=c(3341);let x=new Map,y=new Map;var z=c(5832),A=c(2115),B=c(9544);let C=new Map,D=`You are an expert flashcard creator for students. Given study material (text or an image of study material), create high-quality flashcards.

Rules:
- Create 5-25 flashcards depending on content density (more content = more cards)
- Each flashcard has: front (question), back (answer), type (basic/cloze), difficulty (easy/medium/hard), tags
- For "basic" type: front is a clear question, back is the answer
- For "cloze" type: front is a sentence with a blank (use "______" for the gap), back is ONLY the missing word/phrase
  Example cloze: front="Die Hauptstadt von Frankreich ist ______.", back="Paris"
  NEVER put the answer in the front text for cloze cards!
- Front: Max 500 chars. Back: Max 1000 chars.
- Tags: relevant topic keywords, max 3 per card
- Match the language of the input material
- Focus on key concepts, definitions, relationships, and processes
- Vary difficulty levels, mix basic and cloze types

Return ONLY valid JSON array, no markdown, no explanation:
[{"front":"...","back":"...","type":"basic","difficulty":"medium","tags":["topic1"]}]`;async function E(a,b){let c=(0,u._)().GEMINI_API_KEY;return c?G(c,{parts:[{text:`Language: ${b}

Study material:
${a}`}]}):function(a,b){let c=a.split(/[.\n]/g).map(a=>a.trim()).filter(a=>a.length>12).slice(0,10);return(c.length>0?c:[a.slice(0,120)]).map((a,c)=>{let d=b.startsWith("de")?"Worum geht es in Aussage":"What is the key point in statement";return{front:`${d} ${c+1}?`,back:a,type:c%3==0?"cloze":"basic",difficulty:"medium",tags:["auto-generated",b]}})}(a,b)}async function F(a,b,c){let d=(0,u._)().GEMINI_API_KEY;if(!d)throw Error("GEMINI_API_KEY is required for image processing");return G(d,{parts:[{text:`Language: ${c}

Generate flashcards from the study material in this image:`},{inline_data:{mime_type:b,data:a}}]})}async function G(a,b){let c=`https://generativelanguage.googleapis.com/v1beta/models/gemini-3-flash-preview:generateContent?key=${a}`,d={contents:[{role:"user",parts:[{text:D},...b.parts]}],generationConfig:{temperature:.4,maxOutputTokens:4096,responseMimeType:"application/json"}},e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!e.ok){let a=await e.text();throw Error(`Gemini API error ${e.status}: ${a.slice(0,200)}`)}let f=await e.json();if(f.error)throw Error(`Gemini error: ${f.error.message}`);let g=f.candidates?.[0]?.content?.parts?.[0]?.text;if(!g)throw Error("Gemini returned empty response");let h=JSON.parse(g.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim());if(!Array.isArray(h)||0===h.length)throw Error("Gemini returned invalid flashcard format");return h}async function H(a,b){try{let c=await E(a,b);return{cards:A.IN.parse(c),model:"gemini-3-flash",fallbackUsed:!1}}catch(d){let c=function(a,b){let c=a.split(/[.\n]/g).map(a=>a.trim()).filter(a=>a.length>12).slice(0,10);return(c.length>0?c:[a.slice(0,120)]).map((a,c)=>{let d=b.startsWith("de")?"Worum geht es in Aussage":"What is the key point in statement";return{front:`${d} ${c+1}?`,back:a,type:c%3==0?"cloze":"basic",difficulty:"medium",tags:["auto-generated",b]}})}(a,b);return{cards:A.IN.parse(c),model:"heuristic-fallback",fallbackUsed:!0}}}async function I(a,b,c){let d=await F(a,b,c);return{cards:A.IN.parse(d),model:"gemini-3-flash-vision",fallbackUsed:!1}}async function J(a,b,c){var d,e;let f,g=A.Hr.parse(a),h=(d=g.idempotencyKey,C.get(d)??null);if(h)return h;if(g.imageBase64){let a=g.imageMimeType??"image/jpeg";f=await I(g.imageBase64,a,g.sourceLanguage)}else if(g.extractedText)f=await H(g.extractedText,g.sourceLanguage);else throw Error("Either extractedText or imageBase64 must be provided");let i=A.IN.parse(f.cards),j=g.deckId?await (0,B.k2)(g.deckId):null;for(let a of(j||(j=await (0,B.Ul)(c,"Automatisch erstellt",["scan"])),i))await (0,B.zY)(c,j.id,a);await (0,B.zf)(c,f.model,i.length,"",g.extractedText??void 0);let k={requestId:b,model:f.model,fallbackUsed:f.fallbackUsed,cards:i};return e=g.idempotencyKey,C.set(e,k),k}var K=c(8201);async function L(a){let{requestId:b}=(0,w.LF)(a.headers);try{let c=await (0,z.WV)(a);if(!c)return(0,v.FZ)(b,"UNAUTHORIZED","Authentication required",401);let d=await a.json(),e=c.userId,f=(await (0,K.u)(e)).tier,g=(0,u._)(),h="pro"===f?g.RATE_LIMIT_PRO_PER_MINUTE:g.RATE_LIMIT_FREE_PER_MINUTE;if(!function(a,b,c=Date.now()){let d=x.get(a);return!d||d.expiresAt<=c?(x.set(a,{count:1,expiresAt:c+6e4}),!0):!(d.count>=b)&&(x.set(a,{count:d.count+1,expiresAt:d.expiresAt}),!0)}(`${e}:${f}`,h))return(0,v.FZ)(b,"RATE_LIMITED","Rate limit exceeded",429);let i=function(a,b,c,d=new Date){if("free"!==b)return{allowed:!0,remaining:1/0};let e=function(a=new Date){return`${a.getUTCFullYear()}-${String(a.getUTCMonth()+1).padStart(2,"0")}`}(d),f=y.get(a);if(!f||f.periodStartMonth!==e)return y.set(a,{count:1,periodStartMonth:e}),{allowed:!0,remaining:Math.max(c-1,0)};if(f.count>=c)return{allowed:!1,remaining:0};let g=f.count+1;return y.set(a,{...f,count:g}),{allowed:!0,remaining:Math.max(c-g,0)}}(e,f,g.FREE_SCAN_LIMIT_PER_MONTH);if(!i.allowed)return(0,v.FZ)(b,"PAYWALL_REQUIRED","Free scan quota exceeded",402);let j=await J(d,b,e);return(0,w.fH)("scan_processed",{requestId:b,userId:e,cards:j.cards.length,model:j.model,hasImage:!!d.imageBase64,freeScansRemaining:Number.isFinite(i.remaining)?i.remaining:null}),(0,v.h4)(b,j)}catch(c){let a=(0,v.cQ)(c);return(0,w.vV)("scan_failed",{requestId:b,code:a.code,message:a.message}),(0,v.FZ)(b,a.code,a.message,a.status)}}let M=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/v1/scan/process/route",pathname:"/api/v1/scan/process",filename:"route",bundlePath:"app/api/v1/scan/process/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"/Users/andreasostheimer/Documents/GitHub/cloudlearn/apps/api/app/api/v1/scan/process/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:N,workUnitAsyncStorage:O,serverHooks:P}=M;function Q(){return(0,g.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:O})}async function R(a,b,c){var d;let e="/api/v1/scan/process/route";"/index"===e&&(e="/");let g=await M.prepare(a,b,{srcPage:e,multiZoneDraftMode:!1});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:x,prerenderManifest:y,routerServerContext:z,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,resolvedPathname:C}=g,D=(0,j.normalizeAppPath)(e),E=!!(y.dynamicRoutes[D]||y.routes[C]);if(E&&!x){let a=!!y.routes[C],b=y.dynamicRoutes[D];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let F=null;!E||M.isDev||x||(F="/index"===(F=C)?"/":F);let G=!0===M.isDev||!E,H=E&&!G,I=a.method||"GET",J=(0,i.getTracer)(),K=J.getActiveScopeSpan(),L={params:v,prerenderManifest:y,renderOpts:{experimental:{cacheComponents:!!w.experimental.cacheComponents,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>M.onRequestError(a,b,d,z)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>M.handle(P,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&A&&B&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=L.renderOpts.fetchMetrics;let i=L.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=L.renderOpts.collectedTags;if(!E)return await (0,o.I)(N,O,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await M.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})},z),b}},l=await M.handleResponse({req:a,nextConfig:w,cacheKey:F,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:y,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:B,responseGenerator:k,waitUntil:c.waitUntil});if(!E)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",A?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),x&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&E||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.U)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};K?await g(K):await J.withPropagatedContext(a.headers,()=>J.trace(m.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},g))}catch(b){if(b instanceof s.NoFallbackError||await M.onRequestError(a,b,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:H,isOnDemandRevalidate:A})}),E)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}},4870:a=>{a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5832:(a,b,c)=>{c.d(b,{WV:()=>e});var d=c(1364);async function e(a){let b=a.headers.get("Authorization");if(!b?.startsWith("Bearer "))return null;let c=b.slice(7),e=(0,d.v)();if(!e)return null;let{data:{user:f},error:g}=await e.auth.getUser(c);if(g||!f)return null;let{error:h}=await e.from("profiles").insert({id:f.id});return h&&"23505"!==h.code&&console.error("[auth] profile upsert error:",h.message),{userId:f.id,email:f.email??""}}},6439:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external")},7598:a=>{a.exports=require("node:crypto")},9121:a=>{a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:a=>{a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[252,403,356,500],()=>b(b.s=4131));module.exports=c})();